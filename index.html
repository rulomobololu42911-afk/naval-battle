<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Naval Commander</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ç–æ–ø–ª–µ–Ω–Ω–æ–≥–æ –∫–æ—Ä–∞–±–ª—è
        function checkSunkShip(hitRow, hitCol, shipCells, shots) {
            for (let ship of shipCells) {
                const hitCell = ship.find(cell => cell.row === hitRow && cell.col === hitCol);
                if (hitCell) {
                    const allHit = ship.every(cell => shots[cell.row][cell.col] === 2);
                    if (allHit) {
                        return ship;
                    }
                    break;
                }
            }
            return null;
        }

        // –û—Ç–º–µ—Ç–∫–∞ –æ–∫—Ä—É–∂–∞—é—â–∏—Ö –∫–ª–µ—Ç–æ–∫ –ø–æ—Ç–æ–ø–ª–µ–Ω–Ω–æ–≥–æ –∫–æ—Ä–∞–±–ª—è
        function markSurroundingCells(shipCells, shots) {
            for (let cell of shipCells) {
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        const newRow = cell.row + dr;
                        const newCol = cell.col + dc;
                        if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 8) {
                            if (shots[newRow][newCol] === 0) {
                                shots[newRow][newCol] = 1;
                            }
                        }
                    }
                }
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—è
        function updateBoardDisplay(boardId) {
            const isPlayerBoard = boardId === 'playerBoard';
            const board = isPlayerBoard ? playerBoard : enemyBoard;
            const shots = isPlayerBoard ? enemyShots : playerShots;
            const shipCells = isPlayerBoard ? playerShipCells : enemyShipCells;
            
            const cells = document.querySelectorAll(`#${boardId} .cell`);
            cells.forEach((cell, index) => {
                const row = Math.floor(index / 8);
                const col = index % 8;
                
                cell.className = 'cell';
                
                if (shots[row][col] === 2) {
                    const sunkShip = findSunkShip(row, col, shipCells, shots);
                    if (sunkShip) {
                        cell.classList.add('sunk');
                    } else {
                        cell.classList.add('hit');
                    }
                } else if (shots[row][col] === 1) {
                    cell.classList.add('miss');
                } else if (isPlayerBoard && board[row][col] > 0) {
                    cell.classList.add('ship');
                }
            });
        }

        function findSunkShip(hitRow, hitCol, shipCells, shots) {
            for (let ship of shipCells) {
                const hitCell = ship.find(cell => cell.row === hitRow && cell.col === hitCol);
                if (hitCell) {
                    const allHit = ship.every(cell => shots[cell.row][cell.col] === 2);
                    if (allHit) {
                        return ship;
                    }
                    break;
                }
            }
            return null;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateGameStats() {
            document.getElementById('playerShips').textContent = gameStats.playerShipsAlive;
            document.getElementById('enemyShips').textContent = gameStats.enemyShipsAlive;
            document.getElementById('gameShots').textContent = gameStats.shots;
            const accuracy = gameStats.shots > 0 ? Math.round((gameStats.hits / gameStats.shots) * 100) : 0;
            document.getElementById('gameAccuracy').textContent = accuracy + '%';
        }

        function updateGameStatus(message) {
            document.getElementById('gameStatus').textContent = message;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏
        function updateSetupBoard() {
            const cells = document.querySelectorAll('#setupBoard .cell');
            cells.forEach((cell, index) => {
                const row = Math.floor(index / 8);
                const col = index % 8;
                
                cell.className = 'cell';
                if (playerBoard[row][col] > 0) {
                    cell.classList.add('ship');
                }
            });
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function allShipsPlaced() {
            const result = Object.keys(shipsToPlace).every(size => {
                const placed = placedShips[size] || 0;
                const needed = shipsToPlace[size];
                return placed === needed;
            });
            return result;
        }

        function autoSelectNextShip() {
            for (let size of [4, 3, 2, 1]) {
                if (placedShips[size] < shipsToPlace[size]) {
                    selectShip(size);
                    break;
                }
            }
        }

        function selectShip(size) {
            if (placedShips[size] >= shipsToPlace[size]) return;
            
            selectedShipSize = size;
            document.querySelectorAll('.ship-btn').forEach(btn => btn.classList.remove('selected'));
            document.querySelector(`[data-ship="${size}"]`).classList.add('selected');
        }

        function updateShipButtons() {
            document.querySelectorAll('.ship-btn').forEach(btn => {
                const size = parseInt(btn.dataset.ship);
                const remaining = shipsToPlace[size] - placedShips[size];
                
                if (remaining === 0) {
                    btn.classList.add('completed');
                    btn.classList.remove('selected');
                }
            });
            
            if (allShipsPlaced()) {
                document.getElementById('startBattleBtn').disabled = false;
            }
        }

        function resetShipPlacement() {
            placedShips = {4: 0, 3: 0, 2: 0, 1: 0};
            selectedShipSize = 4;
            isHorizontal = true;
            shipPlacementHistory = [];
            resetPlayerBoard();
            updateSetupBoard();
            
            document.querySelectorAll('.ship-btn').forEach(btn => {
                btn.classList.remove('completed', 'selected');
            });
            document.querySelector('[data-ship="4"]').classList.add('selected');
            document.getElementById('startBattleBtn').disabled = true;
            document.getElementById('orientationText').textContent = '–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ';
        }

        function resetPlayerBoard() {
            playerBoard = Array(8).fill().map(() => Array(8).fill(0));
            playerShipCells = [];
            shipPlacementHistory = [];
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
        function endGame(result) {
            gamePhase = 'ended';
            
            const modal = document.getElementById('resultModal');
            const title = document.getElementById('resultTitle');
            const text = document.getElementById('resultText');
            const reward = document.getElementById('resultReward');
            
            if (result === 'win') {
                title.textContent = '–ü–æ–±–µ–¥–∞!';
                title.className = 'result-title win';
                text.textContent = '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø–æ—Ç–æ–ø–∏–ª–∏ –≤–µ—Å—å –≤—Ä–∞–∂–µ—Å–∫–∏–π —Ñ–ª–æ—Ç!';
                
                const winnings = selectedBet * 2;
                playerBalance += winnings;
                reward.textContent = `+${winnings.toLocaleString()} —Ñ–∞–Ω—Ç–∏–∫–æ–≤`;
            } else {
                title.textContent = '–ü–æ—Ä–∞–∂–µ–Ω–∏–µ';
                title.className = 'result-title lose';
                text.textContent = '–í–∞—à —Ñ–ª–æ—Ç —É–Ω–∏—á—Ç–æ–∂–µ–Ω! –¢—Ä–µ–Ω–∏—Ä—É–π—Ç–µ—Å—å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å!';
                
                playerBalance -= selectedBet;
                reward.textContent = `-${selectedBet.toLocaleString()} —Ñ–∞–Ω—Ç–∏–∫–æ–≤`;
            }
            
            updateBalance();
            modal.style.display = 'flex';
        }

        function surrenderGame() {
            if (confirm('–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —Å–¥–∞—Ç—å—Å—è?')) {
                endGame('lose');
            }
        }

        // –ù–æ–≤–∞—è –∏–≥—Ä–∞
        function newGame() {
            document.getElementById('resultModal').style.display = 'none';
            showScreen('betScreen');
            resetGame();
        }

        function resetGame() {
            gamePhase = 'setup';
            currentPlayer = 'player';
            gameStats = {shots: 0, hits: 0, playerShipsAlive: 10, enemyShipsAlive: 10};
            playerShots = Array(8).fill().map(() => Array(8).fill(0));
            enemyShots = Array(8).fill().map(() => Array(8).fill(0));
            
            // –°–±—Ä–æ—Å –ò–ò
            aiState = 'hunting';
            aiLastHit = null;
            aiTargets = [];
            aiDirection = null;
            
            resetShipPlacement();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            initGame();
        });
    </script>
</body>
</html>

        body {
            font-family: 'Inter', 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f1419 0%, #1a2332 50%, #2d3748 100%);
            color: #e2e8f0;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(0, 150, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 255, 150, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 100, 0, 0.06) 0%, transparent 50%);
            animation: backgroundShift 20s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes backgroundShift {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* –°–¢–ê–†–¢–û–í–ê–Ø –°–¢–†–ê–ù–ò–¶–ê */
        .start-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
        }

        .logo {
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(45deg, #00d4ff, #0099cc, #0066aa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
            animation: logoGlow 3s ease-in-out infinite alternate;
            font-family: inherit;
        }

        @keyframes logoGlow {
            from { filter: drop-shadow(0 0 10px rgba(0, 212, 255, 0.3)); }
            to { filter: drop-shadow(0 0 20px rgba(0, 212, 255, 0.6)); }
        }

        .subtitle {
            font-size: 1.2rem;
            color: #94a3b8;
            margin-bottom: 40px;
            font-weight: 300;
        }

        .balance-display {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 193, 7, 0.1));
            border: 2px solid #ffd700;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 40px;
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.2);
        }

        .balance-amount {
            font-size: 2rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .game-modes {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            max-width: 400px;
        }

        .mode-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .mode-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.8s;
        }

        .mode-card:hover::before {
            left: 100%;
        }

        .mode-card:hover {
            transform: translateY(-5px);
            border-color: rgba(0, 212, 255, 0.5);
            box-shadow: 0 15px 35px rgba(0, 212, 255, 0.2);
        }

        .mode-card.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            position: relative;
        }

        .mode-card.disabled::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
        }

        .mode-card.disabled:hover {
            transform: none;
            border-color: rgba(255,255,255,0.1);
            box-shadow: none;
        }

        .mode-card.disabled:hover::before {
            left: -100%;
        }

        .mode-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            display: block;
        }

        .mode-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: #f1f5f9;
        }

        .mode-desc {
            color: #94a3b8;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .coming-soon {
            color: #ffd700;
            font-size: 0.8rem;
            font-weight: bold;
            margin-top: 8px;
        }

        /* –≠–ö–†–ê–ù –°–¢–ê–í–û–ö */
        .bet-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
        }

        .bet-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .bet-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
            margin: 30px 0;
            width: 100%;
            max-width: 500px;
        }

        .bet-option {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 16px;
            padding: 20px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .bet-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.4);
        }

        .bet-option.selected {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #333;
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
        }

        .bet-option:disabled {
            background: linear-gradient(135deg, #64748b, #475569);
            cursor: not-allowed;
            transform: none;
        }

        /* –≠–ö–†–ê–ù –†–ê–°–°–¢–ê–ù–û–í–ö–ò */
        .setup-screen {
            display: none;
            padding: 20px 0;
        }

        .setup-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .setup-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: #00d4ff;
        }

        .fleet-selection {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .ship-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border: none;
            border-radius: 12px;
            padding: 12px 16px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .ship-btn.completed {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .ship-btn.selected {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: #333;
        }

        .setup-board {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 25px;
            margin: 20px auto;
            max-width: 400px;
            backdrop-filter: blur(10px);
        }

        .board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 3px;
            max-width: 320px;
            margin: 0 auto;
        }

        .cell {
            aspect-ratio: 1;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            position: relative;
            background: rgba(255,255,255,0.03);
        }

        .cell:hover {
            background: rgba(0, 212, 255, 0.2);
            transform: scale(1.05);
        }

        .cell.ship {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.5);
        }

        .cell.hit {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            animation: hitEffect 0.6s ease;
        }

        .cell.hit::after {
            content: 'X';
            color: #ff6b6b;
            font-weight: bold;
            animation: explosion 0.8s ease;
        }

        .cell.miss {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            animation: missEffect 0.4s ease;
        }

        .cell.miss::after {
            content: '‚Ä¢';
            color: #74b9ff;
        }

        .cell.sunk {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            box-shadow: 0 0 20px rgba(108, 92, 231, 0.6);
        }

        .cell.sunk::after {
            content: 'SUNK';
            font-size: 0.6rem;
            font-weight: bold;
            color: #a29bfe;
        }

        .cell.blocked {
            background: rgba(255, 255, 255, 0.1);
            opacity: 0.5;
        }

        @keyframes hitEffect {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); background: #ff3838; }
            100% { transform: scale(1); }
        }

        @keyframes missEffect {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes explosion {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù */
        .game-screen {
            display: none;
            padding: 20px 0;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .game-status {
            font-size: 1.1rem;
            font-weight: 600;
            padding: 12px 20px;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(0, 153, 204, 0.2));
            border-radius: 25px;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }

        .game-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffd700;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #94a3b8;
        }

        .game-boards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .game-boards {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .board-container {
            background: rgba(255,255,255,0.03);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .board-title {
            text-align: center;
            margin-bottom: 15px;
            font-weight: 700;
            font-size: 1.2rem;
            color: #cbd5e1;
        }

        /* –û–ë–©–ò–ï –≠–õ–ï–ú–ï–ù–¢–´ */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            padding: 14px 28px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            background: linear-gradient(135deg, #64748b, #475569);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #333;
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.3);
        }

        .btn-primary:hover {
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        /* –†–ï–ó–£–õ–¨–¢–ê–¢ –ò–ì–†–´ */
        .result-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .result-content {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border-radius: 25px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255,255,255,0.1);
        }

        .result-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 20px;
        }

        .result-title.win {
            color: #ffd700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .result-title.lose {
            color: #ff6b6b;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.5);
        }

        /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .logo {
                font-size: 2.5rem;
            }
            
            .board {
                max-width: 280px;
                gap: 2px;
            }
            
            .cell {
                font-size: 1rem;
            }
            
            .game-header {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –°–¢–ê–†–¢–û–í–´–ô –≠–ö–†–ê–ù -->
        <div class="start-screen" id="startScreen">
            <h1 class="logo">NAVAL COMMANDER</h1>
            <p class="subtitle">–°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ –º–æ—Ä—Å–∫–∏–µ —Å—Ä–∞–∂–µ–Ω–∏—è</p>
            
            <div class="balance-display">
                <div style="color: #94a3b8; margin-bottom: 5px;">–í–∞—à –±–∞–ª–∞–Ω—Å</div>
                <div class="balance-amount" id="balanceAmount">10,000 —Ñ–∞–Ω—Ç–∏–∫–æ–≤</div>
            </div>
            
            <div class="game-modes">
                <div class="mode-card disabled" onclick="handleModeClick('friend')">
                    <span class="mode-icon">VS</span>
                    <div class="mode-title">–°—Ä–∞–∂–µ–Ω–∏–µ —Å –¥—Ä—É–≥–æ–º</div>
                    <div class="mode-desc">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–≥–∞ –∏ —Å—Ä–∞–∑–∏—Ç–µ—Å—å –≤ —á–µ—Å—Ç–Ω–æ–º –ø–æ–µ–¥–∏–Ω–∫–µ</div>
                    <div class="coming-soon">–°–∫–æ—Ä–æ –¥–æ—Å—Ç—É–ø–Ω–æ</div>
                </div>
                
                <div class="mode-card" onclick="handleModeClick('ai')">
                    <span class="mode-icon">AI</span>
                    <div class="mode-title">–ü—Ä–æ—Ç–∏–≤ –ò–ò</div>
                    <div class="mode-desc">–°—Ä–∞–∑–∏—Ç–µ—Å—å —Å —É–º–Ω—ã–º –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º</div>
                </div>
                
                <div class="mode-card disabled" onclick="handleModeClick('online')">
                    <span class="mode-icon">NET</span>
                    <div class="mode-title">–û–Ω–ª–∞–π–Ω –±–∏—Ç–≤–∞</div>
                    <div class="mode-desc">–ù–∞–π–¥–∏—Ç–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É</div>
                    <div class="coming-soon">–°–∫–æ—Ä–æ –¥–æ—Å—Ç—É–ø–Ω–æ</div>
                </div>
            </div>
        </div>

        <!-- –≠–ö–†–ê–ù –í–´–ë–û–†–ê –°–¢–ê–í–ö–ò -->
        <div class="bet-screen" id="betScreen">
            <h2 class="bet-title">–†–∞–∑–º–µ—Ä —Å—Ç–∞–≤–∫–∏</h2>
            <p style="color: #94a3b8; margin-bottom: 20px;">–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–º–º—É –¥–ª—è —É—á–∞—Å—Ç–∏—è –≤ —Å—Ä–∞–∂–µ–Ω–∏–∏</p>
            
            <div class="balance-display">
                <div style="color: #94a3b8; margin-bottom: 5px;">–î–æ—Å—Ç—É–ø–Ω–æ</div>
                <div class="balance-amount" id="betBalanceAmount">10,000 —Ñ–∞–Ω—Ç–∏–∫–æ–≤</div>
            </div>
            
            <div class="bet-options">
                <button class="bet-option" onclick="selectBet(1000)">1,000 —Ñ–∞–Ω—Ç–∏–∫–æ–≤</button>
                <button class="bet-option" onclick="selectBet(2500)">2,500 —Ñ–∞–Ω—Ç–∏–∫–æ–≤</button>
                <button class="bet-option" onclick="selectBet(5000)">5,000 —Ñ–∞–Ω—Ç–∏–∫–æ–≤</button>
                <button class="bet-option" onclick="selectBet(10000)">10,000 —Ñ–∞–Ω—Ç–∏–∫–æ–≤</button>
            </div>
            
            <div class="controls">
                <button class="btn btn-primary" id="confirmBetBtn" onclick="confirmBet()" disabled>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å—Ç–∞–≤–∫—É</button>
                <button class="btn btn-secondary" onclick="showScreen('startScreen')">–ù–∞–∑–∞–¥</button>
            </div>
        </div>

        <!-- –≠–ö–†–ê–ù –†–ê–°–°–¢–ê–ù–û–í–ö–ò –ö–û–†–ê–ë–õ–ï–ô -->
        <div class="setup-screen" id="setupScreen">
            <div class="setup-header">
                <h2 class="setup-title">–†–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–æ—Ç–∞</h2>
                <p style="color: #94a3b8;">–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –∫–æ—Ä–∞–±–ª–∏ –Ω–∞ –∏–≥—Ä–æ–≤–æ–º –ø–æ–ª–µ</p>
            </div>
            
            <div class="fleet-selection">
                <button class="ship-btn selected" data-ship="4" onclick="selectShip(4)">–õ–∏–Ω–∫–æ—Ä (4)</button>
                <button class="ship-btn" data-ship="3" onclick="selectShip(3)">–ö—Ä–µ–π—Å–µ—Ä (3) x2</button>
                <button class="ship-btn" data-ship="2" onclick="selectShip(2)">–≠—Å–º–∏–Ω–µ—Ü (2) x3</button>
                <button class="ship-btn" data-ship="1" onclick="selectShip(1)">–ö–∞—Ç–µ—Ä (1) x4</button>
            </div>
            
            <div class="setup-board">
                <div class="board" id="setupBoard"></div>
            </div>
            
            <div class="controls">
                <button class="btn" onclick="toggleOrientation()">–ü–æ–≤–µ—Ä–Ω—É—Ç—å <span id="orientationText">–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ</span></button>
                <button class="btn" onclick="removeLastShip()">–£–±—Ä–∞—Ç—å –∫–æ—Ä–∞–±–ª—å</button>
                <button class="btn" onclick="randomPlacement()">–°–ª—É—á–∞–π–Ω–∞—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞</button>
                <button class="btn btn-primary" onclick="startBattle()" id="startBattleBtn" disabled>–í –±–æ–π!</button>
            </div>
        </div>

        <!-- –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù -->
        <div class="game-screen" id="gameScreen">
            <div class="game-header">
                <div class="game-status" id="gameStatus">–í–∞—à —Ö–æ–¥! –í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å</div>
                <div class="game-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="playerShips">10</div>
                        <div class="stat-label">–í–∞—à–∏ –∫–æ—Ä–∞–±–ª–∏</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="enemyShips">10</div>
                        <div class="stat-label">–ö–æ—Ä–∞–±–ª–∏ –≤—Ä–∞–≥–∞</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="gameShots">0</div>
                        <div class="stat-label">–í—ã—Å—Ç—Ä–µ–ª–æ–≤</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="gameAccuracy">0%</div>
                        <div class="stat-label">–¢–æ—á–Ω–æ—Å—Ç—å</div>
                    </div>
                </div>
            </div>
            
            <div class="game-boards">
                <div class="board-container">
                    <div class="board-title">–í–∞—à —Ñ–ª–æ—Ç</div>
                    <div class="board" id="playerBoard"></div>
                </div>
                <div class="board-container">
                    <div class="board-title">–§–ª–æ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞</div>
                    <div class="board" id="enemyBoard"></div>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn btn-secondary" onclick="surrenderGame()">–°–¥–∞—Ç—å—Å—è</button>
                <button class="btn" onclick="showScreen('startScreen')">–í –º–µ–Ω—é</button>
            </div>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –†–ï–ó–£–õ–¨–¢–ê–¢–ê -->
    <div class="result-modal" id="resultModal">
        <div class="result-content">
            <h2 class="result-title" id="resultTitle">–ü–æ–±–µ–¥–∞!</h2>
            <p id="resultText">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø–æ—Ç–æ–ø–∏–ª–∏ –≤–µ—Å—å –≤—Ä–∞–∂–µ—Å–∫–∏–π —Ñ–ª–æ—Ç!</p>
            <div id="resultReward" style="margin: 20px 0; font-size: 1.5rem; font-weight: bold; color: #ffd700;"></div>
            <div class="controls">
                <button class="btn btn-primary" onclick="newGame()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
                <button class="btn" onclick="showScreen('startScreen')">–í –º–µ–Ω—é</button>
            </div>
        </div>
    </div>

    <script>
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentScreen = 'startScreen';
        let gameMode = '';
        let selectedBet = 0;
        let playerBalance = 10000;
        let gamePhase = 'setup';
        let currentPlayer = 'player';
        let selectedShipSize = 4;
        let isHorizontal = true;
        let shipsToPlace = {4: 1, 3: 2, 2: 3, 1: 4};
        let placedShips = {4: 0, 3: 0, 2: 0, 1: 0};
        let shipPlacementHistory = [];

        // –ò–ò –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ - –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 3: –£–º–Ω—ã–π –ò–ò
        let aiState = 'hunting'; // hunting, targeting, finishing
        let aiLastHit = null;
        let aiTargets = [];
        let aiDirection = null;
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–æ–ª—è
        let playerBoard = Array(8).fill().map(() => Array(8).fill(0));
        let enemyBoard = Array(8).fill().map(() => Array(8).fill(0));
        let playerShots = Array(8).fill().map(() => Array(8).fill(0));
        let enemyShots = Array(8).fill().map(() => Array(8).fill(0));
        let playerShipCells = [];
        let enemyShipCells = [];
        
        let gameStats = {
            shots: 0,
            hits: 0,
            playerShipsAlive: 10,
            enemyShipsAlive: 10
        };

        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 1: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
        function saveBalance() {
            try {
                if (typeof Storage !== "undefined") {
                    localStorage.setItem('navalBalance', playerBalance.toString());
                }
            } catch (e) {
                console.log('LocalStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
            }
        }

        function loadBalance() {
            try {
                if (typeof Storage !== "undefined") {
                    const saved = localStorage.getItem('navalBalance');
                    if (saved) {
                        playerBalance = parseInt(saved);
                        if (playerBalance < 1000) playerBalance = 10000; // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
                    }
                }
            } catch (e) {
                console.log('LocalStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                playerBalance = 10000;
            }
        }

        function updateBalance() {
            document.getElementById('balanceAmount').textContent = `${playerBalance.toLocaleString()} —Ñ–∞–Ω—Ç–∏–∫–æ–≤`;
            document.getElementById('betBalanceAmount').textContent = `${playerBalance.toLocaleString()} —Ñ–∞–Ω—Ç–∏–∫–æ–≤`;
            saveBalance(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å—Ç–∞–≤–æ–∫
            updateBetOptions();
        }

        function updateBetOptions() {
            const betOptions = document.querySelectorAll('.bet-option');
            betOptions.forEach(btn => {
                const amount = parseInt(btn.textContent.replace(/\D/g, ''));
                if (amount > playerBalance) {
                    btn.disabled = true;
                    btn.style.opacity = '0.5';
                } else {
                    btn.disabled = false;
                    btn.style.opacity = '1';
                }
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            loadBalance(); // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 1: –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å
            updateBalance();
            showScreen('startScreen');
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞–º–∏
        function showScreen(screenId) {
            document.querySelectorAll('.start-screen, .bet-screen, .setup-screen, .game-screen').forEach(screen => {
                screen.style.display = 'none';
            });
            document.getElementById(screenId).style.display = screenId === 'startScreen' ? 'flex' : 'block';
            currentScreen = screenId;
        }

        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ —Ä–µ–∂–∏–º–∞–º –∏–≥—Ä—ã
        function handleModeClick(mode) {
            if (mode === 'friend' || mode === 'online') {
                // –î–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                return;
            }
            
            selectGameMode(mode);
        }

        function selectGameMode(mode) {
            gameMode = mode;
            showScreen('betScreen');
            updateBalance();
        }

        // –í—ã–±–æ—Ä —Å—Ç–∞–≤–∫–∏
        function selectBet(amount) {
            if (amount > playerBalance) {
                alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤! –£ –≤–∞—Å ${playerBalance.toLocaleString()} —Ñ–∞–Ω—Ç–∏–∫–æ–≤.`);
                return;
            }
            
            selectedBet = amount;
            document.querySelectorAll('.bet-option').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            document.getElementById('confirmBetBtn').disabled = false;
        }

        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏
        function confirmBet() {
            if (selectedBet === 0 || selectedBet > playerBalance) return;
            
            showScreen('setupScreen');
            initSetup();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏
        function initSetup() {
            createSetupBoard();
            generateEnemyFleet(); // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 4: –£–ª—É—á—à–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–ª–æ—Ç–∞
            resetShipPlacement();
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—è –¥–ª—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∏
        function createSetupBoard() {
            const board = document.getElementById('setupBoard');
            board.innerHTML = '';
            
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    cell.onclick = () => placeShip(i, j);
                    board.appendChild(cell);
                }
            }
        }

        // –†–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–æ—Ä–∞–±–ª—è
        function placeShip(row, col) {
            if (placedShips[selectedShipSize] >= shipsToPlace[selectedShipSize]) return;
            
            if (canPlaceShip(row, col, selectedShipSize, isHorizontal)) {
                const shipCells = [];
                for (let i = 0; i < selectedShipSize; i++) {
                    const newRow = isHorizontal ? row : row + i;
                    const newCol = isHorizontal ? col + i : col;
                    playerBoard[newRow][newCol] = selectedShipSize;
                    shipCells.push({row: newRow, col: newCol});
                }
                playerShipCells.push(shipCells);
                
                shipPlacementHistory.push({
                    size: selectedShipSize,
                    cells: [...shipCells]
                });
                
                placedShips[selectedShipSize]++;
                updateSetupBoard();
                updateShipButtons();
                autoSelectNextShip();
                
                if (allShipsPlaced()) {
                    document.getElementById('startBattleBtn').disabled = false;
                }
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–Ω–æ–≥–æ –∫–æ—Ä–∞–±–ª—è
        function removeLastShip() {
            if (shipPlacementHistory.length === 0) return;
            
            const lastShip = shipPlacementHistory.pop();
            
            for (let cell of lastShip.cells) {
                playerBoard[cell.row][cell.col] = 0;
            }
            
            playerShipCells = playerShipCells.filter(ship => {
                return !arraysEqual(ship, lastShip.cells);
            });
            
            placedShips[lastShip.size]--;
            
            updateSetupBoard();
            updateShipButtons();
            document.getElementById('startBattleBtn').disabled = !allShipsPlaced();
            
            selectShip(lastShip.size);
        }

        function arraysEqual(a, b) {
            if (a.length !== b.length) return false;
            return a.every((val, index) => val.row === b[index].row && val.col === b[index].col);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è
        function canPlaceShip(row, col, size, horizontal) {
            for (let i = 0; i < size; i++) {
                const newRow = horizontal ? row : row + i;
                const newCol = horizontal ? col + i : col;
                
                if (newRow >= 8 || newCol >= 8) return false;
                if (playerBoard[newRow][newCol] !== 0) return false;
                
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        const checkRow = newRow + dr;
                        const checkCol = newCol + dc;
                        if (checkRow >= 0 && checkRow < 8 && checkCol >= 0 && checkCol < 8) {
                            if (playerBoard[checkRow][checkCol] !== 0) return false;
                        }
                    }
                }
            }
            return true;
        }

        function toggleOrientation() {
            isHorizontal = !isHorizontal;
            document.getElementById('orientationText').textContent = isHorizontal ? '–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ' : '–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ';
        }

        // –°–ª—É—á–∞–π–Ω–∞—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞
        function randomPlacement() {
            resetPlayerBoard();
            shipPlacementHistory = [];
            
            const ships = [4, 3, 3, 2, 2, 2, 1, 1, 1, 1];
            
            for (let ship of ships) {
                let placed = false;
                let attempts = 0;
                
                while (!placed && attempts < 1000) {
                    const row = Math.floor(Math.random() * 8);
                    const col = Math.floor(Math.random() * 8);
                    const horizontal = Math.random() > 0.5;
                    
                    if (canPlaceShip(row, col, ship, horizontal)) {
                        const shipCells = [];
                        for (let i = 0; i < ship; i++) {
                            const newRow = horizontal ? row : row + i;
                            const newCol = horizontal ? col + i : col;
                            playerBoard[newRow][newCol] = ship;
                            shipCells.push({row: newRow, col: newCol});
                        }
                        playerShipCells.push(shipCells);
                        shipPlacementHistory.push({size: ship, cells: [...shipCells]});
                        placedShips[ship]++;
                        placed = true;
                    }
                    attempts++;
                }
            }
            
            updateSetupBoard();
            updateShipButtons();
            document.getElementById('startBattleBtn').disabled = false;
        }

        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 4: –£–ª—É—á—à–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–ª–æ—Ç–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
        function generateEnemyFleet() {
            console.log('üö¢ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ñ–ª–æ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...');
            enemyBoard = Array(8).fill().map(() => Array(8).fill(0));
            enemyShipCells = [];
            
            const ships = [4, 3, 3, 2, 2, 2, 1, 1, 1, 1]; // –†–æ–≤–Ω–æ 10 –∫–æ—Ä–∞–±–ª–µ–π
            
            for (let shipSize of ships) {
                let placed = false;
                let attempts = 0;
                const maxAttempts = 2000;
                
                while (!placed && attempts < maxAttempts) {
                    const row = Math.floor(Math.random() * 8);
                    const col = Math.floor(Math.random() * 8);
                    const horizontal = Math.random() > 0.5;
                    
                    if (canPlaceEnemyShipImproved(row, col, shipSize, horizontal)) {
                        const shipCells = [];
                        for (let i = 0; i < shipSize; i++) {
                            const newRow = horizontal ? row : row + i;
                            const newCol = horizontal ? col + i : col;
                            enemyBoard[newRow][newCol] = shipSize;
                            shipCells.push({row: newRow, col: newCol});
                        }
                        enemyShipCells.push(shipCells);
                        placed = true;
                        console.log(`‚úÖ –ö–æ—Ä–∞–±–ª—å ${shipSize} —Ä–∞–∑–º–µ—â–µ–Ω –ø–æ—Å–ª–µ ${attempts} –ø–æ–ø—ã—Ç–æ–∫`);
                    }
                    attempts++;
                }
                
                if (!placed) {
                    console.error(`‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –∫–æ—Ä–∞–±–ª—å ${shipSize}!`);
                    forceShipPlacement(shipSize);
                }
            }
            
            console.log(`üéØ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ö–æ—Ä–∞–±–ª–µ–π: ${enemyShipCells.length}`);
            console.log('üìä –†–∞–∑–º–µ—Ä—ã –∫–æ—Ä–∞–±–ª–µ–π:', enemyShipCells.map(ship => ship.length));
        }

        function canPlaceEnemyShipImproved(row, col, size, horizontal) {
            if (horizontal && col + size > 8) return false;
            if (!horizontal && row + size > 8) return false;
            
            for (let i = 0; i < size; i++) {
                const shipRow = horizontal ? row : row + i;
                const shipCol = horizontal ? col : col + i;
                
                if (enemyBoard[shipRow][shipCol] !== 0) return false;
                
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        const checkRow = shipRow + dr;
                        const checkCol = shipCol + dc;
                        
                        if (checkRow >= 0 && checkRow < 8 && checkCol >= 0 && checkCol < 8) {
                            if (enemyBoard[checkRow][checkCol] !== 0) return false;
                        }
                    }
                }
            }
            
            return true;
        }

        function forceShipPlacement(size) {
            console.log(`üîß –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–æ—Ä–∞–±–ª—è ${size}`);
            
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    for (let horizontal of [true, false]) {
                        if (canPlaceEnemyShipLoose(row, col, size, horizontal)) {
                            const shipCells = [];
                            for (let i = 0; i < size; i++) {
                                const newRow = horizontal ? row : row + i;
                                const newCol = horizontal ? col + i : col;
                                enemyBoard[newRow][newCol] = size;
                                shipCells.push({row: newRow, col: newCol});
                            }
                            enemyShipCells.push(shipCells);
                            console.log(`‚úÖ –ö–æ—Ä–∞–±–ª—å ${size} –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–º–µ—â–µ–Ω –≤ ${row},${col}`);
                            return;
                        }
                    }
                }
            }
        }

        function canPlaceEnemyShipLoose(row, col, size, horizontal) {
            if (horizontal && col + size > 8) return false;
            if (!horizontal && row + size > 8) return false;
            
            for (let i = 0; i < size; i++) {
                const shipRow = horizontal ? row : row + i;
                const shipCol = horizontal ? col : col + i;
                if (enemyBoard[shipRow][shipCol] !== 0) return false;
            }
            
            return true;
        }

        // –ù–∞—á–∞–ª–æ –±–∏—Ç–≤—ã
        function startBattle() {
            console.log('‚öîÔ∏è startBattle –≤—ã–∑–≤–∞–Ω–∞');
            console.log('üìã allShipsPlaced:', allShipsPlaced());
            console.log('üö¢ placedShips:', placedShips);
            
            if (!allShipsPlaced()) {
                alert('–°–Ω–∞—á–∞–ª–∞ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç–µ –≤—Å–µ –∫–æ—Ä–∞–±–ª–∏!');
                return;
            }
            
            gamePhase = 'playing';
            currentPlayer = 'player';
            gameStats = {shots: 0, hits: 0, playerShipsAlive: 10, enemyShipsAlive: 10};
            
            // –°–±—Ä–æ—Å –ò–ò
            aiState = 'hunting';
            aiLastHit = null;
            aiTargets = [];
            aiDirection = null;
            
            playerShots = Array(8).fill().map(() => Array(8).fill(0));
            enemyShots = Array(8).fill().map(() => Array(8).fill(0));
            
            showScreen('gameScreen');
            createGameBoards();
            updateGameStats();
            updateGameStatus('–í–∞—à —Ö–æ–¥! –í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å –Ω–∞ –ø–æ–ª–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞');
            
            console.log('üéÆ –ë–∏—Ç–≤–∞ –Ω–∞—á–∞–ª–∞—Å—å!');
            console.log('üë§ –ö–æ—Ä–∞–±–ª–µ–π –∏–≥—Ä–æ–∫–∞:', playerShipCells.length);
            console.log('ü§ñ –ö–æ—Ä–∞–±–ª–µ–π –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞:', enemyShipCells.length);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–≤—ã—Ö –ø–æ–ª–µ–π
        function createGameBoards() {
            createBoard('playerBoard', true);
            createBoard('enemyBoard', false);
        }

        function createBoard(boardId, isPlayerBoard) {
            const board = document.getElementById(boardId);
            board.innerHTML = '';
            
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    
                    if (!isPlayerBoard) {
                        cell.onclick = () => playerShoot(i, j);
                    }
                    
                    board.appendChild(cell);
                }
            }
            
            updateBoardDisplay(boardId);
        }

        // –í—ã—Å—Ç—Ä–µ–ª –∏–≥—Ä–æ–∫–∞
        function playerShoot(row, col) {
            if (gamePhase !== 'playing' || currentPlayer !== 'player') return;
            if (playerShots[row][col] !== 0) return;
            
            gameStats.shots++;
            const hit = enemyBoard[row][col] > 0;
            playerShots[row][col] = hit ? 2 : 1;
            
            if (hit) {
                gameStats.hits++;
                gameStats.enemyShipsAlive--;
                
                const sunkShip = checkSunkShip(row, col, enemyShipCells, playerShots);
                if (sunkShip) {
                    markSurroundingCells(sunkShip, playerShots);
                    updateGameStatus('–ö–æ—Ä–∞–±–ª—å –ø–æ—Ç–æ–ø–ª–µ–Ω! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å—Ç—Ä–µ–ª—å–±—É');
                } else {
                    updateGameStatus('–ü–æ–ø–∞–¥–∞–Ω–∏–µ! –í–∞—à —Ö–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è');
                }
                
                if (gameStats.enemyShipsAlive === 0) {
                    endGame('win');
                    return;
                }
            } else {
                updateGameStatus('–ü—Ä–æ–º–∞—Ö. –•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞');
                currentPlayer = 'enemy';
                setTimeout(enemyTurn, 1500);
            }
            
            updateBoardDisplay('enemyBoard');
            updateGameStats();
        }

        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï 3: –£–ª—É—á—à–µ–Ω–Ω—ã–π –ò–ò –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
        function enemyTurn() {
            if (gameMode !== 'ai' || gamePhase !== 'playing' || currentPlayer !== 'enemy') return;
            
            let row, col;
            
            // –í—ã–±–æ—Ä —Ü–µ–ª–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –ò–ò
            if (aiState === 'targeting' && aiTargets.length > 0) {
                const target = aiTargets.shift();
                row = target.row;
                col = target.col;
                console.log(`üéØ –ò–ò –¥–æ–±–∏–≤–∞–µ—Ç —Ü–µ–ª—å: ${row},${col}`);
            } else if (aiState === 'finishing' && aiDirection && aiLastHit) {
                const nextTarget = getNextInDirection(aiLastHit, aiDirection);
                if (nextTarget && isValidTarget(nextTarget.row, nextTarget.col)) {
                    row = nextTarget.row;
                    col = nextTarget.col;
                    console.log(`üî• –ò–ò –¥–æ–±–∏–≤–∞–µ—Ç –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏: ${row},${col}`);
                } else {
                    aiState = 'hunting';
                    const target = getRandomTarget();
                    row = target.row;
                    col = target.col;
                    console.log(`üîç –ò–ò –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ø–æ–∏—Å–∫—É: ${row},${col}`);
                }
            } else {
                const target = getRandomTarget();
                row = target.row;
                col = target.col;
                console.log(`üé≤ –ò–ò —Å–ª—É—á–∞–π–Ω—ã–π –ø–æ–∏—Å–∫: ${row},${col}`);
            }
            
            const hit = playerBoard[row][col] > 0;
            enemyShots[row][col] = hit ? 2 : 1;
            
            if (hit) {
                gameStats.playerShipsAlive--;
                aiLastHit = {row, col};
                
                const sunkShip = checkSunkShip(row, col, playerShipCells, enemyShots);
                if (sunkShip) {
                    markSurroundingCells(sunkShip, enemyShots);
                    updateGameStatus('–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –ø–æ—Ç–æ–ø–∏–ª –≤–∞—à –∫–æ—Ä–∞–±–ª—å!');
                    aiState = 'hunting';
                    aiTargets = [];
                    aiDirection = null;
                    console.log('üíÄ –ò–ò –ø–æ—Ç–æ–ø–∏–ª –∫–æ—Ä–∞–±–ª—å, –≤–æ–∑–≤—Ä–∞—Ç –∫ –ø–æ–∏—Å–∫—É');
                } else {
                    if (aiState === 'hunting') {
                        aiState = 'targeting';
                        addAdjacentTargets(row, col);
                        console.log('üîé –ò–ò –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∂–∏–º –¥–æ–±–∏–≤–∞–Ω–∏—è');
                    } else if (aiState === 'targeting') {
                        aiState = 'finishing';
                        aiDirection = getDirection(aiLastHit, {row, col});
                        console.log('üìç –ò–ò –æ–ø—Ä–µ–¥–µ–ª–∏–ª –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–∞–±–ª—è');
                    }
                    updateGameStatus('–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –ø–æ–ø–∞–ª! –û–Ω —Å—Ç—Ä–µ–ª—è–µ—Ç –µ—â–µ —Ä–∞–∑');
                }
                
                if (gameStats.playerShipsAlive === 0) {
                    endGame('lose');
                    return;
                }
                
                setTimeout(() => {
                    if (gamePhase === 'playing' && currentPlayer === 'enemy') {
                        enemyTurn();
                    }
                }, 1500);
            } else {
                updateGameStatus('–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –ø—Ä–æ–º–∞—Ö–Ω—É–ª—Å—è. –í–∞—à —Ö–æ–¥!');
                currentPlayer = 'player';
                if (aiTargets.length === 0) {
                    aiState = 'hunting';
                }
                console.log('üíß –ò–ò –ø—Ä–æ–º–∞—Ö–Ω—É–ª—Å—è');
            }
            
            updateBoardDisplay('playerBoard');
            updateGameStats();
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ò–ò
        function getRandomTarget() {
            let row, col;
            do {
                row = Math.floor(Math.random() * 8);
                col = Math.floor(Math.random() * 8);
            } while (enemyShots[row][col] !== 0);
            return {row, col};
        }

        function isValidTarget(row, col) {
            return row >= 0 && row < 8 && col >= 0 && col < 8 && enemyShots[row][col] === 0;
        }

        function addAdjacentTargets(row, col) {
            const directions = [{row: -1, col: 0}, {row: 1, col: 0}, {row: 0, col: -1}, {row: 0, col: 1}];
            for (let dir of directions) {
                const newRow = row + dir.row;
                const newCol = col + dir.col;
                if (isValidTarget(newRow, newCol)) {
                    aiTargets.push({row: newRow, col: newCol});
                }
            }
        }

        function getDirection(from, to) {
            if (from.row === to.row) {
                return to.col > from.col ? {row: 0, col: 1} : {row: 0, col: -1};
            } else {
                return to.row > from.row ? {row: 1, col: 0} : {row: -1, col: 0};
            }
        }

        function getNextInDirection(pos, direction) {
            return {
                row: pos.row + direction.row,
                col: pos.col + direction.col
            };
        }
